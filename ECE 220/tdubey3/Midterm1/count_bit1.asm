
.ORIG x3000

INIT_REGS
  AND R0, R0, #0
  AND R1, R1, #0
  AND R2, R2, #0
  AND R3, R3, #0
  AND R4, R4, #0
  AND R5, R5, #0
  AND R6, R6, #0

  LD R6, INPUT_ADDRESS
  LDR R6, R6, #0

; TODO

  AND R4, R4, #0 ; INIT COUNT
  AND R3, R3, #0 ; INIT LOOP COUNT
  ADD R3, R3, #15; SET LOOP COUNT VALUE
LOOP  
  ADD R6, R6, #0 ; SET NZP BIT
  BRz FORWARD
  ADD R5, R6, #-1 
  AND R6, R5, R6 ; BIT SHIFT
  ADD R4, R4, #1
FORWARD
  ADD R3, R3, #-1; DECREMENT COUNTER
  BRn DONE
  BRnzp LOOP

; END TODO
DONE
	ADD R0, R4, R0 ; STORE VALUE
	STI R0, OUTPUT_VALUE

HALT

; Memory definition.
INPUT_ADDRESS .FILL x5000
OUTPUT_VALUE .FILL x5000

.END
